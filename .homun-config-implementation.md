# Homunculus Configuration Implementation Summary

## Overview
Implemented support for local configuration file at `~/.config/homun/config.yml` to customize usernames and base URLs for GitHub and Gitea platforms, with sane defaults when config file is absent.

## Changes Made

### 1. New Files Created

#### `/workspace/cmd/summon_homun/config.go`
- `Config` struct with `GitHub` and `Gitea` sub-configs
- `LoadConfig()` function to load from `~/.config/homun/config.yml` or return defaults
- `GetRepoName()` method to determine appropriate username based on repository URL
- Automatic detection of GitHub vs Gitea based on URL patterns

#### `/workspace/cmd/summon_homun/config_test.go`
- Unit tests for config loading with and without config file
- Tests for GetRepoName() logic with different URL patterns
- Tests cover GitHub, Gitea, and empty URL scenarios

#### `/workspace/cmd/summon_homun/config.example.yml`
- Example configuration file with comments
- Shows proper YAML structure for GitHub and Gitea settings

### 2. Modified Files

#### `/workspace/cmd/summon_homun/main.go`
- Added config loading in main() before initializing model
- Passes loaded config to model
- Handles config loading errors gracefully

#### `/workspace/cmd/summon_homun/git.go`
- Modified `getDefaultRepo()` to accept `*Config` parameter
- Uses config to determine appropriate username based on repository URL
- Removed unused imports (fmt, os/user)

#### `/workspace/cmd/summon_homun/model.go`
- Added `config *Config` field to model struct

#### `/workspace/cmd/summon_homun/update.go`
- Updated `StateInputRepo` handler to pass config to `getDefaultRepo()`

#### `/workspace/cmd/summon_homun/docker.go`
- Updated docker run logic to pass config to `getDefaultRepo()`

#### `/workspace/cmd/summon_homun/view.go`
- Updated `StateInputRepo` view to pass config to `getDefaultRepo()`
- Added username display in `StateConfirm` view showing GitHub and Gitea usernames

#### `/workspace/go.mod`
- Added `gopkg.in/yaml.v3 v3.0.1` dependency for YAML parsing

#### `/workspace/cmd/summon_homun/README.md`
- Added "Configuration File" section with example
- Documented all configuration options
- Explained how platform detection works

## Configuration File Structure

```yaml
github:
  username: bharathcs
  base_url: https://github.com

gitea:
  username: bhcs
  base_url: https://gitea.example.com
```

## Default Behavior

When `~/.config/homun/config.yml` doesn't exist:
- GitHub username: system username
- GitHub base URL: `https://github.com`
- Gitea username: system username
- Gitea base URL: `https://gitea.com`

## Platform Detection Logic

The tool automatically determines whether to use GitHub or Gitea configuration based on:
1. Repository URL contains "github.com" → uses GitHub username
2. Repository URL contains "gitea" or matches Gitea base URL → uses Gitea username
3. Empty/no URL → defaults to Gitea username

## Use Case Example

User has different usernames on different platforms:
- GitHub: `bharathcs`
- Gitea: `bhcs`

Repository name will be constructed as:
- For GitHub repos: `bharathcs/repo-name`
- For Gitea repos: `bhcs/repo-name`

This ensures correct repository paths when working with multiple Git hosting platforms.

## Testing

Unit tests cover:
- Config loading without file (uses defaults)
- Config loading with file (parses YAML correctly)
- GetRepoName() with various URL patterns
- Default value application for missing fields

## Backward Compatibility

The implementation maintains full backward compatibility:
- If no config file exists, system username is used (existing behavior)
- All existing environment variables still work
- No breaking changes to existing workflows
